(function(){'use strict';window.cakeciousProWooCommerce={initCartFloatingCheckoutButton:function(){var $section=document.querySelector('.woocommerce-cart .cakecious-cart-mobile-sticky-checkout');if(!$section){return;}
var $bar=$section.querySelector('.cakecious-cart-mobile-sticky-checkout-inner'),$button=$bar.querySelector('.checkout-button'),$page=document.getElementById('page'),isScrolling=false;var updateStickyCheckoutButton=function(){if(isScrolling){return;}else{isScrolling=true;}
var windowScrollOffset=window.pageYOffset+window.innerHeight,sectionScrollOffset=cakeciousHelper.getOffset($section).top;if(windowScrollOffset<sectionScrollOffset){$bar.classList.add('cakecious-show');}else{$bar.classList.remove('cakecious-show');}
isScrolling=false;}
window.addEventListener('resize',updateStickyCheckoutButton,false);window.addEventListener('scroll',updateStickyCheckoutButton,false);window.addEventListener('load',updateStickyCheckoutButton,false);updateStickyCheckoutButton();},initQuickView:function(){var $popup=document.querySelector('#product-quick-view');if(!$popup){return;}
var $content=$popup.querySelector('.cakecious-product-quick-view-content');var handleQuickViewToggle=function(e){var $this=e.target.closest('ul.products li.product .cakecious-product-quick-view-button');if(!$this)return;var request=new XMLHttpRequest(),params={action:'cakecious_woocommerce_render_product_quick_view',product_id:$this.getAttribute('data-product_id'),},queryString=Object.keys(params).map(function(key){return key+'='+params[key];}).join('&');request.open('GET',cakeciousProConfig.ajaxURL+'?'+queryString,true);request.addEventListener('load',function(){if(request.status>=200&&request.status<400){$content.innerHTML=request.responseText;var $gallery=$content.querySelector('.woocommerce-product-gallery');var $links=Array.prototype.slice.call($gallery.querySelectorAll('.woocommerce-product-gallery__image > a'));$links.forEach(function($link){$link.outerHTML=$link.innerHTML;});if(1<$links.length&&jQuery.fn.flexslider){jQuery($gallery).flexslider({selector:'.woocommerce-product-gallery__wrapper > .woocommerce-product-gallery__image',start:function(slider){$gallery.style.opacity=1;$popup.classList.add('cakecious-loaded');},rtl:false,animation:'slide',smoothHeight:false,directionNav:false,controlNav:true,slideshow:false,animationSpeed:500,animationLoop:false,allowOneSlide:false,});}else{$gallery.style.opacity=1;$popup.classList.add('cakecious-loaded');}
cakeciousProWooCommerce.initAJAXAddToCart($popup);jQuery('.variations_form').each(function(){jQuery(this).wc_variation_form();});}});request.send();}
document.addEventListener('click',handleQuickViewToggle,false);document.addEventListener('touchend',handleQuickViewToggle,false);var handleQuickViewClose=function(e){var $this=e.target.closest('.cakecious-product-quick-view .cakecious-popup-close');if(!$this)return;setTimeout(function(){$content.innerHTML='';$popup.classList.remove('cakecious-loaded');},500);}
document.addEventListener('click',handleQuickViewClose,false);document.addEventListener('touchend',handleQuickViewClose,false);var handleFeaturedImageOnMobile=function(e){var $this=e.target.closest('.cakecious-product-thumbnail a');if(!$this)return;var $wrapper=$this.closest('.cakecious-product-thumbnail-with-quick-view');if(!$wrapper)return;var $button=$wrapper.querySelector('.cakecious-product-quick-view-button');if(!$button)return;if($this!==document.activeElement&&$button!==document.activeElement){document.activeElement.blur();$button.focus();e.preventDefault();}}
document.addEventListener('touchend',handleFeaturedImageOnMobile,false);},initAJAXAddToCart:function($scope){if(typeof wc_add_to_cart_params==='undefined'){return;}
$scope=(typeof $scope!=='undefined')?$scope:document;var $forms=Array.prototype.slice.call($scope.querySelectorAll('.cakecious-product-add-to-cart.cakecious-ajax-add-to-cart-form form'));$forms.forEach(function($form){if('get'===$form.method.toLowerCase()){return;}
var $button=$form.querySelector('.single_add_to_cart_button');if(!$button){return;}
$form.addEventListener('submit',function(e){e.preventDefault();$button.classList.remove('added');$button.classList.add('loading');var dataPairs={};for(var j=0;j<$form.elements.length;j++){var $field=$form.elements[j];if(!$field.name||$field.disabled)continue;if('select-multiple'===$field.type){for(var k=0;k<$field.options.length;k++){if(!$field.options[k].selected)continue;dataPairs[$field.name]=$field.options[k].value;}}
else if('checkbox'===$field.type||'radio'===$field.type){if($field.checked){dataPairs[$field.name]=$field.value;}}
else{dataPairs[$field.name]=$field.value;}}
if('undefined'!==typeof dataPairs['variation_id']){dataPairs['product_id']=dataPairs['variation_id'];delete dataPairs['variation_id'];delete dataPairs['add-to-cart'];}
else if('undefined'!==typeof dataPairs['add-to-cart']&&'undefined'===typeof dataPairs['product_id']){dataPairs['product_id']=dataPairs['add-to-cart'];delete dataPairs['add-to-cart'];}
var data=Object.keys(dataPairs).map(function(key){return key+'='+dataPairs[key];}).join('&');jQuery(document.body).trigger('adding_to_cart',[$button,data]);var request=new XMLHttpRequest();request.open('POST',wc_add_to_cart_params.wc_ajax_url.toString().replace('%%endpoint%%','add_to_cart'),true);request.setRequestHeader('Content-Type','application/x-www-form-urlencoded');request.addEventListener('load',function(){$button.classList.add('added');$button.classList.remove('loading');if(request.status>=200&&request.status<400){var response=JSON.parse(request.responseText);if(response.error&&response.product_url){window.location=response.product_url;return;}
if('yes'===wc_add_to_cart_params.cart_redirect_after_add&&1!=wc_add_to_cart_params.is_cart){window.location=wc_add_to_cart_params.cart_url;return;}
jQuery(document.body).trigger('added_to_cart',[response.fragments,response.cart_hash,jQuery($button)]);}},false);request.send(encodeURI(data));},false);});},initAJAXAddedToCartHighlight:function(){if(document.body.classList.contains('cakecious-ajax-added-to-cart-open-header-cart')){jQuery(document.body).on('wc_fragments_loaded',function(){var $headerCartToggle=document.querySelector('.cakecious-header-shopping-cart .cakecious-toggle');if(!$headerCartToggle){return;}
if(!document.body.classList.contains('cakecious-has-popup-active')){$headerCartToggle.click();}});}},initAll:function(){window.cakeciousProWooCommerce.initCartFloatingCheckoutButton();window.cakeciousProWooCommerce.initQuickView();window.cakeciousProWooCommerce.initAJAXAddToCart();window.cakeciousProWooCommerce.initAJAXAddedToCartHighlight();},}
document.addEventListener('DOMContentLoaded',window.cakeciousProWooCommerce.initAll,false);})();